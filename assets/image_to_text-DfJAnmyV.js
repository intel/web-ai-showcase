import{s as z}from"./navbar-iFJqFhkS.js";import{g as O,d as j,r as I,h as F,b as _,f as p,c as B,a as G,i as q}from"./utility-mp7EoVF_.js";import{A as H}from"./config-C7GNoNA1.js";import{W as V}from"./worker-Di1GZ2aN.js";const W=""+new URL("cats.png",import.meta.url).href;z("../..");const P=new V,A="transformers-cache",h="vit-gpt2-image-captioning",X=document.getElementById("upload"),L=document.getElementById("image-wrapper"),M=document.getElementById("image2text-output-textbox"),f=document.getElementById("progress"),K=document.getElementById("example"),m=document.getElementById("status"),v=document.getElementById("loadModelPromptContent"),b=document.getElementById("loadingModelText"),Q=document.getElementById("loadModelBtn"),J=document.getElementById("modelPopover"),x=document.getElementById("progressBar"),Y=document.getElementById("modelPanelWrapper"),Z=O(h),l=j(h);let w=0,E=null,R=null;const D={max_new_tokens:50,num_beams:1,temperature:1,top_k:0,do_sample:!1};for(const[t,e]of Object.entries(D))document.getElementById(t).value=e;function ee(){let t={};for(const[e,s]of Object.entries(D)){const a=document.getElementById(e);a&&a.value!==void 0&&(e==="do_sample"?t[e]=a.value==="true":t[e]=parseInt(a.value))}return t}function $(){const t=M.value;t===R?(S(),m.parentElement.classList.toggle("hidden"),m.textContent="",E=null):(R=t,clearTimeout(E),E=setTimeout($,1500))}K.addEventListener("click",t=>{t.preventDefault();const e=new Image;e.onload=function(){m.textContent="Generating ... ",m.parentElement.classList.toggle("hidden"),S(),w=new Date().getTime(),k(e)},e.classList.add("object-contain","w-full"),e.src=W,L.innerHTML="",L.appendChild(e)});X.addEventListener("change",t=>{const e=t.target.files[0],s=URL.createObjectURL(e),a=new Image;a.onload=function(){m.textContent="Generating",m.parentElement.classList.toggle("hidden"),S(),w=new Date().getTime(),k(a)},a.classList.add("object-contain","w-full"),a.src=s,L.innerHTML="",L.appendChild(a)});function te(t){const e=document.createElement("canvas");return e.width=t.naturalWidth,e.height=t.naturalHeight,e.getContext("2d").drawImage(t,0,0,e.width,e.height),e.toDataURL()}function S(){document.querySelectorAll(".control-entry").forEach(t=>{t.classList.toggle("opacity-25"),t.classList.toggle("cursor-pointer");const e=t.querySelector("input");e&&(e.disabled=!e.disabled),t.disabled=!t.disabled})}function k(t){let e={baseURI:document.baseURI,task:"image-to-text",generation:ee(),image:te(t),elementIdToUpdate:M.id};P.postMessage(e)}P.addEventListener("message",t=>{if(!t.data)return;const e=t.data;switch(e.type){case"download":if(e.data.status==="initiate"){if(!e.data.file||e.data.file.split(".").length>0&&e.data.file.split(".")[1]!=="onnx"||!l[e.data.file]||l[e.data.file].cached)break;I(b,f),f.appendChild(F(`<div model="${e.data.name}" file="${e.data.file}"
      class="relative my-4 rounded-2xl w-full min-h-[30px] bg-stone-200/40 flex items-center justify-between font-mono"
    >
  <div class="relative px-2 z-20" name="statusText"></div>
  <div class="relative px-2 z-20">
    <span name="progressVal">0%</span>
  </div>
  <div
    name="progressBar"
    class="absolute top-0 rounded-2xl z-10 text-right bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"
  ></div>
  </div>`))}else{if(e.data.status==="ready"){f.classList.contains("hidden")||f.classList.add("hidden"),b.classList.contains("hidden")||b.classList.add("hidden");break}const d=f.querySelector(`div[model="${e.data.name}"][file="${e.data.file}"]`),n=document.getElementById(`${e.data.file.match(/\/?([^/.]+?)(?:\.[^/.]+)?$/)[1]}StatusBar`);switch(e.data.status){case"progress":if(!e.data.file||!l[e.data.file])break;const i=e.data.file;if(n){if(l[i].cached){n.textContent="loading",B("loading",n),l[i].size=e.data.total;break}else if(n.textContent="downloading",B("loading",n),l[i].size=e.data.total,d!==null){const r=d.querySelector("div[name='statusText']"),o=d.querySelector("div[name='progressBar']"),c=d.querySelector("span[name='progressVal']");o.style.height||(o.style.height="30px"),o.style.width=e.data.progress.toFixed(2)+"%",c.textContent=e.data.progress.toFixed(2)+"%",r.textContent=`${e.data.file} (${p(e.data.loaded)} / ${p(e.data.total)})`}}break;case"done":if(!e.data.file||!l[e.data.file])break;let u=new Date().getTime();if(d!==null&&d.classList.add("hidden"),I(document.getElementById(`${_(e.data.file)}StatusFlag`)),n){let r="downloaded",o=0;const c=e.data.file;l[c]&&(o=l[c].size,l[c].cached&&(r="cache loaded")),n.textContent=`${r} in ${((u-w)/1e3).toFixed(2)}s(${p(o)})`,B("loaded",n),o=0}break}}break;case"update":let s=e.target,a=document.getElementById(s);a.value=e.data,E||(R=document.getElementById(s).value,E=setTimeout($,1500));break;case"complete":document.getElementById(e.target).value=e.data;break}});G(h,Y);function ae(){H[h].resources.map(t=>{const e=_(t),s=document.getElementById(`uploadInput4${e}`);s&&s.addEventListener("change",async function(a){const d=a.target.files;if(!d.length)return;const n=await caches.open(A);for(const i of d){const u=new FileReader;u.onprogress=function(r){if(r.lengthComputable){const o=r.loaded,c=r.total;I(x),x.innerHTML=`
            <div class="relative px-2 z-20" id="StatusText"></div>
            <div class="relative px-2 z-20">
              <span id="ProgressVal">0%</span>
            </div>
            <div
              id="ProgressBar"
              class="absolute top-0 rounded-2xl z-10 text-right bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"
            ></div>
         `;const C=document.getElementById("StatusText"),g=document.getElementById("ProgressBar"),T=document.getElementById("ProgressVal");let y=o/c*100;C.textContent="Uploading model ...",g.style.height||(g.style.height="30px"),g.style.width=`${y}%`,T.textContent=`${p(o)}/${p(c)}`}},u.onload=async function(r){const o=r.target.result,c=new Blob([o]),g=(i.name.split(".").length>0?i.name.split(".")[1]:"")==="json"?"text/plain; charset=utf-8":"binary/octet-stream",T=new Response(c,{headers:{"Content-Length":c.size.toString(),"Accept-Ranges":"bytes","Content-Type":g}}),y=O(h)+t;await n.match(y)||n.put(y,T).then(()=>{console.log(`cache ${t} successfully.`),U()}).catch(N=>{console.error(`cache ${t} failed:`,N)}),x.classList.contains("hidden")||x.classList.add("hidden")},u.readAsArrayBuffer(i)}})})}ae();async function U(){let t=await caches.open(A);for(const e of Object.keys(l)){let s="",a="";const d=Z+e,n=await t.match(d),i=document.getElementById(`${e.match(/\/?([^/.]+?)(?:\.[^/.]+)?$/)[1]}StatusBar`);!n||!n.ok?(s="unload",a="unload"):(s="cached",a="cache available",l[e].cached=!0,v&&!v.classList.contains("hidden")&&v.classList.add("hidden"),I(document.getElementById(`${_(e)}StatusFlag`))),i&&(B(s,i),i.textContent=a)}}await U();q(Q,J);
