import{s as w}from"./navbar-B3GQCZKa.js";import{g as C,d as A,r as y,h as $,b as v,f,c as h,a as P,i as D}from"./utility-BDkhytlL.js";import{W as M}from"./worker-CRkNIbqi.js";import{A as k}from"./config-hvj4ggRh.js";w("../..");const b=new M,O="transformers-cache",B="distilbert-base-cased-distilled-squad",N=document.getElementById("contextInput"),z=document.getElementById("questionInput"),U=document.getElementById("answerOutput"),g=document.getElementById("progress"),q=document.getElementById("triggerBtn"),T=document.getElementById("loadingModelText"),X=document.getElementById("loadModelPromptContent"),p=document.getElementById("progressBar"),F=document.getElementById("loadModelBtn"),V=document.getElementById("modelPopover"),W=document.getElementById("modelPanelWrapper"),L=C(B),a=A(B);let R=0;q.addEventListener("click",async l=>{const e={baseURI:document.baseURI,task:"question-answering",context:N.value,question:z.value,elementIdToUpdate:U.id};R=new Date().getTime(),b.postMessage(e)});b.addEventListener("message",l=>{if(!l.data)return;const e=l.data;switch(e.type){case"download":if(e.data.status==="initiate"){if(!e.data.file||e.data.file.split(".").length>0&&e.data.file.split(".")[1]!=="onnx"||!a[e.data.file]||a[e.data.file].cached||a[e.data.file].cached)break;y(T,g),g.appendChild($(`<div model="${e.data.name}" file="${e.data.file}"
      class="relative my-4 rounded-2xl w-full min-h-[30px] bg-stone-200/40 flex items-center justify-between font-mono"
    >
  <div class="relative px-2 z-20" name="statusText"></div>
  <div class="relative px-2 z-20">
    <span name="progressVal">0%</span>
  </div>
  <div
    name="progressBar"
    class="absolute top-0 rounded-2xl z-10 text-right bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"
  ></div>
  </div>`))}else{if(e.data.status==="ready"){g.classList.contains("hidden")||g.classList.add("hidden"),T.classList.contains("hidden")||T.classList.add("hidden");return}const o=g.querySelector(`div[model="${e.data.name}"][file="${e.data.file}"]`),t=document.getElementById(`${e.data.file.match(/\/?([^/.]+?)(?:\.[^/.]+)?$/)[1]}StatusBar`);switch(e.data.status){case"progress":if(!e.data.file||!a[e.data.file])break;const n=e.data.file;if(t){if(a[n]&&a[n].cached){t.textContent="loading",h("loading",t),a[n].size=e.data.total;return}else if(t.textContent="downloading",h("loading",t),a[n].size=e.data.total,o!==null){const i=o.querySelector("div[name='statusText']"),s=o.querySelector("div[name='progressBar']"),d=o.querySelector("span[name='progressVal']");s.style.height||(s.style.height="30px"),s.style.width=e.data.progress.toFixed(2)+"%",d.textContent=e.data.progress.toFixed(2)+"%",i.textContent=`${e.data.file} (${f(e.data.loaded)} / ${f(e.data.total)})`}}break;case"done":let m=new Date().getTime();if(o!==null&&o.classList.add("hidden"),y(document.getElementById(`${v(e.data.file)}StatusFlag`)),t){let i="downloaded",s=0;const d=e.data.file;a[d]&&(s=a[d].size,a[d].cached&&(i="cache loaded")),t.textContent=`${i} in ${((m-R)/1e3).toFixed(2)}s(${f(s)})`,h("loaded",t),s=0}break}}break;case"update":let c=e.target,r=document.getElementById(c);r.value=e.data;break;case"complete":document.getElementById(e.target).value=e.data;break}});P(B,W);function G(){k[B].resources.map(l=>{const e=v(l),c=document.getElementById(`uploadInput4${e}`);c&&c.addEventListener("change",async function(r){const o=r.target.files;if(!o.length)return;const t=await caches.open(O);for(const n of o){const m=new FileReader;m.onprogress=function(i){if(i.lengthComputable){const s=i.loaded,d=i.total;y(p),p.innerHTML=`
            <div class="relative px-2 z-20" id="StatusText"></div>
            <div class="relative px-2 z-20">
              <span id="ProgressVal">0%</span>
            </div>
            <div
              id="ProgressBar"
              class="absolute top-0 rounded-2xl z-10 text-right bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"
            ></div>
         `;const I=document.getElementById("StatusText"),u=document.getElementById("ProgressBar"),x=document.getElementById("ProgressVal");let E=s/d*100;I.textContent="Uploading model ...",u.style.height||(u.style.height="30px"),u.style.width=`${E}%`,x.textContent=`${f(s)}/${f(d)}`}},m.onload=async function(i){const s=i.target.result,d=new Blob([s]),u=(n.name.split(".").length>0?n.name.split(".")[1]:"")==="json"?"text/plain; charset=utf-8":"binary/octet-stream",x=new Response(d,{headers:{"Content-Length":d.size.toString(),"Accept-Ranges":"bytes","Content-Type":u}}),E=L+l;await t.match(E)||t.put(E,x).then(()=>{console.log(`cache ${l} successfully.`),S()}).catch(_=>{console.error(`cache ${l} failed:`,_)}),p.classList.contains("hidden")||p.classList.add("hidden")},m.readAsArrayBuffer(n)}})})}G();async function S(){let l=await caches.open(O);for(const e of Object.keys(a)){let c="",r="";const o=L+e,t=await l.match(o),n=document.getElementById(`${e.match(/\/?([^/.]+?)(?:\.[^/.]+)?$/)[1]}StatusBar`);!t||!t.ok?(c="unload",r="unload"):(c="cached",r="cache available",a[e].cached=!0,y(document.getElementById(`${v(e)}StatusFlag`),X)),n&&(h(c,n),n.textContent=r)}}await S();D(F,V);
